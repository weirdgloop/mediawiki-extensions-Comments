{"version":3,"file":"index.js","mappings":";;;;;;;;;;;;;;AAAA,MAAMA,oBAAoB,CAAC;EAC1BC,WAAWA,CAAEC,OAAO,EAAEC,MAAM,EAAEC,qBAAqB,EAAG;IACrD,MAAMC,IAAI,GAAG,IAAI;;IAEjB;IACA,IAAI,CAACH,OAAO,GAAGA,OAAO;;IAEtB;IACA,IAAI,CAACC,MAAM,GAAGA,MAAM;IAEpB,IAAI,CAACC,qBAAqB,GAAGA,qBAAqB;IAElD,IAAI,CAACE,QAAQ,GAAG,IAAI;;IAEpB;IACA,IAAI,CAACC,UAAU,GAAGC,CAAC,CAAE,OAAQ,CAAC,CAACC,IAAI,CAAE,IAAI,EAAE,0BAA2B,CAAC;IACvE,IAAI,CAACC,UAAU,GAAGF,CAAC,CAAE,OAAQ,CAAC,CAACG,QAAQ,CAAE,iBAAkB,CAAC;IAC5D,IAAI,CAACC,MAAM,GAAGJ,CAAC,CAAE,YAAa,CAAC,CAC7BC,IAAI,CAAE;MACNI,IAAI,EAAE,CAAC;MACPC,WAAW,EAAEC,EAAE,CAACC,GAAG,CAAE,kCAAmC;IACzD,CAAE,CAAC;IACJ,IAAI,CAACC,SAAS,GAAG,IAAIC,EAAE,CAACC,EAAE,CAACC,YAAY,CAAE;MACxCC,KAAK,EAAE;IACR,CAAE,CAAC;IACH,IAAI,CAACJ,SAAS,CAACK,EAAE,CAAE,OAAO,EAAE,MAAM;MACjCjB,IAAI,CAACkB,WAAW,CAAC,CAAC;IACnB,CAAE,CAAC;IACH,IAAI,CAACC,QAAQ,GAAGhB,CAAC,CAAE,OAAQ,CAAC,CAACC,IAAI,CAAE,IAAI,EAAE,kCAAmC,CAAC,CAC3EgB,MAAM,CAAE,IAAI,CAACR,SAAS,CAACS,QAAS,CAAC;;IAEnC;IACA,IAAI,CAAChB,UAAU,CAACe,MAAM,CAAE,IAAI,CAACb,MAAO,CAAC;IACrC,IAAI,CAACL,UAAU,CAACkB,MAAM,CAAE,IAAI,CAACf,UAAU,EAAE,IAAI,CAACc,QAAS,CAAC;;IAExD;IACA,IAAI,CAACZ,MAAM,CAACe,iBAAiB,CAAC,CAAC;EAChC;EAEAC,YAAYA,CAAA,EAAG;IACd,MAAMC,GAAG,GAAG,IAAI,CAACjB,MAAM,CAACkB,cAAc,CAAC,CAAC;IACxC,OAAOD,GAAG,CAAEA,GAAG,CAACE,MAAM,GAAG,CAAC,CAAE;EAC7B;EAEAR,WAAWA,CAAA,EAAG;IACb,MAAMlB,IAAI,GAAG,IAAI;IACjB,MAAM2B,MAAM,GAAG3B,IAAI,CAACuB,YAAY,CAAC,CAAC,CAACI,MAAM;IACzC,MAAMC,QAAQ,GAAGD,MAAM,CAACE,UAAU,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;IAE7DJ,MAAM,CAACK,mBAAmB,CAAEJ,QAAS,CAAC,CAACK,IAAI,CAAGC,QAAQ,IAAM;MAC3D,IAAI,CAACrC,OAAO,CAACsC,IAAI,CAAE,sBAAsB,EAAE;QAC1CC,MAAM,EAAEpC,IAAI,CAACF,MAAM,CAACuC,WAAW;QAC/BC,QAAQ,EAAEtC,IAAI,CAACC,QAAQ;QACvBsC,IAAI,EAAEL;MACP,CAAE,CAAC;IACJ,CAAE,CAAC;EACJ;AACD;AAEA,iEAAevC,oBAAoB;;;;;;;;;;;;;;AC3DnC,MAAM6C,OAAO,CAAC;EACb5C,WAAWA,CAAE6C,IAAI,EAAG;IACnB,IAAI,CAACC,EAAE,GAAGD,IAAI,CAACC,EAAE,IAAI,IAAI;IACzB,IAAI,CAACC,OAAO,GAAGF,IAAI,CAACE,OAAO,KAAK,IAAI,GAAGF,IAAI,CAACE,OAAO,GAAG,KAAK;IAC3D,IAAI,CAACC,MAAM,GAAGH,IAAI,CAACG,MAAM,IAAI,CAAC;IAC9B,IAAI,CAACC,IAAI,GAAGJ,IAAI,CAACI,IAAI,IAAI,EAAE;IAC3B,IAAI,CAACX,QAAQ,GAAGO,IAAI,CAACP,QAAQ,IAAI,EAAE;IACnC,IAAI,CAACY,KAAK,GAAGL,IAAI,CAACK,KAAK,IAAI,CAAC,CAAC;IAE7B,IAAI,CAACC,SAAS,GAAG,KAAK;IAEtB,IAAI,CAAC1B,QAAQ,GAAGlB,CAAC,CAAE,OAAQ,CAAC,CAC1BG,QAAQ,CAAE,8BAA+B,CAAC,CAC1CmC,IAAI,CAAE,IAAI,EAAE,IAAI,CAACC,EAAG,CAAC,CACrBG,IAAI,CAAE,IAAI,CAACA,IAAK,CAAC;EACpB;AACD;AAEA,iEAAeL,OAAO;;;;;;;;;;;;;;;;AClBmB;AACT;AAEhC,MAAMS,oBAAoB,CAAC;EAC1BrD,WAAWA,CAAEC,OAAO,EAAEC,MAAM,EAAG;IAC9B,IAAI,CAACoD,IAAI,GAAG,KAAK;IACjB;IACA,IAAI,CAACrD,OAAO,GAAGA,OAAO;IACtB;IACA,IAAI,CAACC,MAAM,GAAGA,MAAM;IAEpB,IAAI,CAACI,UAAU,GAAGC,CAAC,CAAE,OAAQ,CAAC,CAACC,IAAI,CAAE,IAAI,EAAE,mBAAoB,CAAC;EACjE;EAEA+C,YAAYA,CAAA,EAAG;IACd,MAAMnD,IAAI,GAAG,IAAI;IACjB,IAAI,CAACH,OAAO,CAACuD,GAAG,CAAE,oBAAoB,GAAGpD,IAAI,CAACF,MAAM,CAACuC,WAAW,EAAE,CAAC,CAAE,CAAC,CAACJ,IAAI,CAAGoB,GAAG,IAAM;MACtF,IAAKC,MAAM,CAACC,SAAS,CAACC,cAAc,CAACC,IAAI,CAAEJ,GAAG,EAAE,CAAE,UAAU,CAAG,CAAC,EAAG;QAClE,KAAM,MAAMZ,IAAI,IAAIY,GAAG,CAACK,QAAQ,EAAG;UAClC,IAAI,CAACA,QAAQ,CAACC,IAAI,CAAE,IAAInB,gDAAO,CAAEC,IAAK,CAAE,CAAC;QAC1C;MACD;IACD,CAAE,CAAC;EACJ;EAEAmB,iBAAiBA,CAAA,EAAG;IACnB,MAAM5D,IAAI,GAAG,IAAI;IACjBG,CAAC,CAAE0D,MAAO,CAAC,CAAC5C,EAAE,CAAE,qCAAqC,EAAE,MAAM;MAC5D,IAAK+B,sDAAe,CAAE,IAAI,CAAC9C,UAAW,CAAC,IAAI,CAAC,IAAI,CAACgD,IAAI,EAAG;QACvD,IAAI,CAACA,IAAI,GAAG,IAAI;QAChBlD,IAAI,CAACmD,YAAY,CAAC,CAAC;MACpB;IACD,CAAE,CAAC;EACJ;AACD;AAEA,iEAAeF,oBAAoB;;;;;;;;;;;;;;ACpCnC;AACA;AACA;AACA;AACO,MAAMD,eAAe,GAAKc,EAAE,IAAM;EACxC,IAAKA,EAAE,YAAYC,MAAM,EAAG;IAC3BD,EAAE,GAAGA,EAAE,CAAE,CAAC,CAAE;EACb;EAEA,MAAME,IAAI,GAAGF,EAAE,CAACG,qBAAqB,CAAC,CAAC;EAEvC,OACCD,IAAI,CAACE,GAAG,IAAI,CAAC,IACbF,IAAI,CAACG,IAAI,IAAI,CAAC,IACdH,IAAI,CAACI,MAAM,KAAMP,MAAM,CAACQ,WAAW,IAAIzC,QAAQ,CAAC0C,eAAe,CAACC,YAAY,CAAE,IAC9EP,IAAI,CAACQ,KAAK,KAAMX,MAAM,CAACY,UAAU,IAAI7C,QAAQ,CAAC0C,eAAe,CAACI,WAAW,CAAE;AAE7E,CAAC;;;;;;UCjBD;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;ACNa;;AAE6C;AACA;AAE1D,MAAMC,QAAQ,CAAC;EACd/E,WAAWA,CAAA,EAAG;IACb,IAAI,CAACsD,IAAI,GAAG,KAAK;IACjB,IAAI,CAACpD,MAAM,GAAGY,EAAE,CAACZ,MAAM,CAACsD,GAAG,CAAE,CAC5B,aAAa,CACZ,CAAC;IACH,IAAI,CAACvD,OAAO,GAAG,IAAIa,EAAE,CAACkE,IAAI,CAAC,CAAC;IAE5B,IAAI,CAAC7E,qBAAqB,GAAG,IAAIkD,6DAAoB,CAAE,IAAI,CAACpD,OAAO,EAAE,IAAI,CAACC,MAAO,CAAC;IAClF,IAAI,CAAC+E,oBAAoB,GAAG,IAAIlF,6DAAoB,CAAE,IAAI,CAACE,OAAO,EAAE,IAAI,CAACC,MAAM,EAAE,IAAI,CAACC,qBAAsB,CAAC;IAC7G,IAAI,CAACG,UAAU,GAAGC,CAAC,CAAE,OAAQ,CAAC,CAC5BC,IAAI,CAAE,IAAI,EAAE,wBAAyB,CAAC,CACtCgB,MAAM,CACNjB,CAAC,CAAE,MAAO,CAAC,CAACoC,IAAI,CAAE7B,EAAE,CAACoE,OAAO,CAAE,2BAA4B,CAAC,CAACvC,IAAI,CAAC,CAAE,CAAC,EACpE,IAAI,CAACsC,oBAAoB,CAAC3E,UAAU,EACpC,IAAI,CAACH,qBAAqB,CAACG,UAC5B,CAAC;IACF,IAAI,CAAC0D,iBAAiB,CAAC,CAAC;EACzB;;EAEA;AACD;AACA;EACCmB,kBAAkBA,CAAA,EAAG;IACpB5E,CAAC,CAAE,cAAe,CAAC,CAACiB,MAAM,CAAE,IAAI,CAAClB,UAAW,CAAC;EAC9C;;EAEA;AACD;AACA;EACC0D,iBAAiBA,CAAA,EAAG;IACnBzD,CAAC,CAAE,MAAM,IAAI,CAAC4E,kBAAkB,CAAC,CAAE,CAAC;IACpC,IAAI,CAAChF,qBAAqB,CAAC6D,iBAAiB,CAAC,CAAC;EAC/C;AACD;AAEAC,MAAM,CAACH,QAAQ,GAAG,IAAIiB,QAAQ,CAAC,CAAC,C","sources":["/w/extensions/Comments/./src/frontend/AddCommentController.js","/w/extensions/Comments/./src/frontend/Comment.js","/w/extensions/Comments/./src/frontend/CommentListContoller.js","/w/extensions/Comments/./src/frontend/util.js","/w/extensions/Comments/webpack/bootstrap","/w/extensions/Comments/webpack/runtime/define property getters","/w/extensions/Comments/webpack/runtime/hasOwnProperty shorthand","/w/extensions/Comments/webpack/runtime/make namespace object","/w/extensions/Comments/./src/frontend/index.js"],"sourcesContent":["class AddCommentController {\n\tconstructor( restApi, config, commentListController ) {\n\t\tconst self = this;\n\n\t\t/** @type MediaWiki.Rest */\n\t\tthis.restApi = restApi;\n\n\t\t/** @type object */\n\t\tthis.config = config;\n\n\t\tthis.commentListController = commentListController;\n\n\t\tthis.parentId = null;\n\n\t\t// Create all the DOM elements\n\t\tthis.$container = $( '<div>' ).attr( 'id', 'ext-comments-add-comment' );\n\t\tthis.$inputArea = $( '<div>' ).addClass( 've-area-wrapper' );\n\t\tthis.$input = $( '<textarea>' )\n\t\t\t.attr( {\n\t\t\t\trows: 5,\n\t\t\t\tplaceholder: mw.msg( 'comments-add-comment-placeholder' )\n\t\t\t} );\n\t\tthis.submitBtn = new OO.ui.ButtonWidget( {\n\t\t\tlabel: 'Post comment'\n\t\t} );\n\t\tthis.submitBtn.on( 'click', () => {\n\t\t\tself.postComment();\n\t\t} );\n\t\tthis.$toolbar = $( '<div>' ).attr( 'id', 'ext-comments-add-comment-toolbar' )\n\t\t\t.append( this.submitBtn.$element );\n\n\t\t// Add the elements to the DOM\n\t\tthis.$inputArea.append( this.$input );\n\t\tthis.$container.append( this.$inputArea, this.$toolbar );\n\n\t\t// Apply VE using VEForAll\n\t\tthis.$input.applyVisualEditor();\n\t}\n\n\tgetCurrentVe() {\n\t\tconst ins = this.$input.getVEInstances();\n\t\treturn ins[ ins.length - 1 ];\n\t}\n\n\tpostComment() {\n\t\tconst self = this;\n\t\tconst target = self.getCurrentVe().target;\n\t\tconst document = target.getSurface().getModel().getDocument();\n\n\t\ttarget.getWikitextFragment( document ).then(( wikitext ) => {\n\t\t\tthis.restApi.post( '/comments/v0/comment', {\n\t\t\t\tpageid: self.config.wgArticleId,\n\t\t\t\tparentid: self.parentId,\n\t\t\t\ttext: wikitext\n\t\t\t} );\n\t\t} );\n\t}\n}\n\nexport default AddCommentController;\n","class Comment {\n\tconstructor( data ) {\n\t\tthis.id = data.id || null;\n\t\tthis.deleted = data.deleted !== null ? data.deleted : false;\n\t\tthis.rating = data.rating || 0;\n\t\tthis.html = data.html || '';\n\t\tthis.wikitext = data.wikitext || '';\n\t\tthis.actor = data.actor || {};\n\n\t\tthis.isEditing = false;\n\n\t\tthis.$element = $( '<div>' )\n\t\t\t.addClass( 'ext-comments-comment-wrapper' )\n\t\t\t.data( 'id', this.id )\n\t\t\t.html( this.html );\n\t}\n}\n\nexport default Comment;\n","import { isElementInView } from './util';\nimport Comment from './Comment';\n\nclass CommentListContoller {\n\tconstructor( restApi, config ) {\n\t\tthis.init = false;\n\t\t/** @type MediaWiki.Rest */\n\t\tthis.restApi = restApi;\n\t\t/** @type object */\n\t\tthis.config = config;\n\n\t\tthis.$container = $( '<div>' ).attr( 'id', 'ext-comments-tree' );\n\t}\n\n\tloadComments() {\n\t\tconst self = this;\n\t\tthis.restApi.get( '/comments/v0/page/' + self.config.wgArticleId, {} ).then(( res ) => {\n\t\t\tif ( Object.prototype.hasOwnProperty.call( res, [ 'comments' ] ) ) {\n\t\t\t\tfor ( const data of res.comments ) {\n\t\t\t\t\tthis.comments.push( new Comment( data ) );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\taddEventListeners() {\n\t\tconst self = this;\n\t\t$( window ).on( 'DOMContentLoaded load resize scroll', () => {\n\t\t\tif ( isElementInView( this.$container ) && !this.init ) {\n\t\t\t\tthis.init = true;\n\t\t\t\tself.loadComments();\n\t\t\t}\n\t\t} );\n\t}\n}\n\nexport default CommentListContoller;\n","/**\n * @param {HTMLElement|jQuery} el\n * @returns {boolean}\n */\nexport const isElementInView = ( el ) => {\n\tif ( el instanceof jQuery ) {\n\t\tel = el[ 0 ];\n\t}\n\n\tconst rect = el.getBoundingClientRect();\n\n\treturn (\n\t\trect.top >= 0 &&\n\t\trect.left >= 0 &&\n\t\trect.bottom <= ( window.innerHeight || document.documentElement.clientHeight ) &&\n\t\trect.right <= ( window.innerWidth || document.documentElement.clientWidth )\n\t);\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","'use strict';\n\nimport AddCommentController from './AddCommentController';\nimport CommentListContoller from './CommentListContoller';\n\nclass Comments {\n\tconstructor() {\n\t\tthis.init = false;\n\t\tthis.config = mw.config.get( [\n\t\t\t'wgArticleId'\n\t\t] );\n\t\tthis.restApi = new mw.Rest();\n\n\t\tthis.commentListController = new CommentListContoller( this.restApi, this.config );\n\t\tthis.addCommentController = new AddCommentController( this.restApi, this.config, this.commentListController );\n\t\tthis.$container = $( '<div>' )\n\t\t\t.attr( 'id', 'ext-comments-container' )\n\t\t\t.append(\n\t\t\t\t$( '<h3>' ).text( mw.message( 'comments-container-header' ).text() ),\n\t\t\t\tthis.addCommentController.$container,\n\t\t\t\tthis.commentListController.$container\n\t\t\t);\n\t\tthis.addEventListeners();\n\t}\n\n\t/**\n\t * Add the container for the comments interface to the page\n\t */\n\taddContainerToPage() {\n\t\t$( '#bodyContent' ).append( this.$container );\n\t}\n\n\t/**\n\t * Add the required event listeners\n\t */\n\taddEventListeners() {\n\t\t$( () => this.addContainerToPage() );\n\t\tthis.commentListController.addEventListeners();\n\t}\n}\n\nwindow.comments = new Comments();\n"],"names":["AddCommentController","constructor","restApi","config","commentListController","self","parentId","$container","$","attr","$inputArea","addClass","$input","rows","placeholder","mw","msg","submitBtn","OO","ui","ButtonWidget","label","on","postComment","$toolbar","append","$element","applyVisualEditor","getCurrentVe","ins","getVEInstances","length","target","document","getSurface","getModel","getDocument","getWikitextFragment","then","wikitext","post","pageid","wgArticleId","parentid","text","Comment","data","id","deleted","rating","html","actor","isEditing","isElementInView","CommentListContoller","init","loadComments","get","res","Object","prototype","hasOwnProperty","call","comments","push","addEventListeners","window","el","jQuery","rect","getBoundingClientRect","top","left","bottom","innerHeight","documentElement","clientHeight","right","innerWidth","clientWidth","Comments","Rest","addCommentController","message","addContainerToPage"],"sourceRoot":""}